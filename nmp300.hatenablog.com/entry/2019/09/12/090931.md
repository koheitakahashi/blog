---
Title: postgresqlãŒç«‹ã¡ä¸ŠãŒã‚‰ãªããªã£ãŸæ™‚ã®è§£æ±ºæ–¹æ³•
Category:
- TIL
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
Date: 2019-09-12T09:09:31+09:00
URL: https://docs.koheitakahashi.com/entry/2019/09/12/090931
EditURL: https://blog.hatena.ne.jp/NMP300/nmp300.hatenablog.com/atom/entry/26006613430748801
---

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ“ä½œã‚’å­¦ç¿’ã—ã‚ˆã†ã¨ã€postgresã‚’èµ·å‹•ã—ãŸã¨ã“ã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã—ã¾ã„ã€ä½•æ™‚é–“ã‚‚æ‚©ã‚“ã§ã—ã¾ã£ãŸã®ã§ã€ãã®è§£æ±ºæ–¹æ³•ã‚’è‡ªåˆ†ãŒå¿˜ã‚Œãªã„ã‚ˆã†ã«ã¾ã¨ã‚ã¾ã™ğŸ’ª

## è‡ªåˆ†ã®ç’°å¢ƒ
ã‚µãƒ¼ãƒãƒ¼

  - ã•ãã‚‰VPS
  - Debian 9.9
  - postgresql 11.5

ã‚¯ãƒ©ã‚¤ã‚¨ãƒ³ãƒˆ
 
  - mac os Mojave ãƒãƒ¼ã‚¸ãƒ§ãƒ³10.14.6
  - ã‚¿ãƒ¼ãƒŸãƒŠãƒ«

## èµ·ã£ãŸå•é¡Œ
ç›´å‰ã¾ã§æ™®é€šã«ç«‹ã¡ä¸ŠãŒã£ã¦ã„ãŸã€psqlãŒæ€¥ã«ç«‹ã¡ä¸ŠãŒã‚‰ãªããªã‚Šã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸã€‚

å‡ºç¾ã—ãŸã‚¨ãƒ©ãƒ¼
```
psql: could not connect to server: No such file or directory
	Is the server running locally and accepting
	connections on Unix domain socket "/tmp/.s.PGSQL.5432"?
```

## ã‚¨ãƒ©ãƒ¼ãŒã§ãŸæ‰‹é †
1. ã‚¯ãƒ©ã‚¤ã‚¨ãƒ³ãƒˆã§ã€`psql -U ãƒ¦ãƒ¼ã‚¶ãƒ¼å -d postgres -h ãƒ›ã‚¹ãƒˆå`ã§psqlã‚’ç«‹ã¡ä¸Šã’ã¦ã€`CREATE DATEBASE shop`ã¨ã„ã†å­¦ç¿’ç”¨ã®shopã¨ã„ã†ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã—ãŸã‚ã¨ã€ä¸€åº¦ã€`\q`ã§çµ‚äº†ã—ã¾ã—ãŸã€‚

2. ãã®å¾Œã€`psql -U ãƒ¦ãƒ¼ã‚¶ãƒ¼å -d shop -h ãƒ›ã‚¹ãƒˆå`ã§postgresã‚’ç«‹ã¡ä¸Šã’ã‚ˆã†ã¨ã—ãŸã¨ã“ã‚ã€ä¸Šè¨˜ã®å‡ºç¾ã—ãŸã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã€ç«‹ã¡ä¸ŠãŒã‚‰ãªããªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚


## è§£æ±ºã—ãŸæ‰‹é †
[PostgreSQL ã§ psql ã‚³ãƒãƒ³ãƒ‰ ã‚’å®Ÿè¡Œã—ãŸã‚‰ could not connect to database postgres: could not connect to server: No such file or directory ã¨å‡ºã‚‹å ´åˆ](https://obel.hatenablog.jp/entry/20181027/1540588239)ã®æ‰‹é †ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚

### 1. `pg_lscluster`ã§çŠ¶æ³ã‚’ç¢ºèªã™ã‚‹ã€‚

```
$ pg_lsclusters
Ver Cluster Port Status Owner    Data directory              Log file
11  main    5432 down   postgres /var/lib/postgresql/11/main /var/log/postgresql/postgresql-11-main.log
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¹ã‚¿ã®è¨­å®šã¨çŠ¶æ…‹ã«é–¢ã™ã‚‹æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

### 2. `pg_ctlcluster  ~ start`ã§ã‚¯ãƒ©ã‚¹ã‚¿ã‚’é–‹å§‹ã•ã›ã¦ã¿ã¾ã™ã€‚

ã“ã“ã§ã€~ã®ä¸­ã«ã¯ã€1ã®`var`ã¨`cluster`ã®å€¤ãŒå…¥ã‚Šã¾ã™ã€‚
```
$ pg_ctlcluster 11 main start
Warning: the cluster will not be running as a systemd service. Consider using systemctl:
  sudo systemctl start postgresql@11-main
Error: /usr/lib/postgresql/11/bin/pg_ctl /usr/lib/postgresql/11/bin/pg_ctl start -D /var/lib/postgresql/11/main -l /var/log/postgresql/postgresql-11-main.log -s -o  -c config_file="/etc/postgresql/11/main/postgresql.conf"  exited with status 1: 
```

ä»Šå›ã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã•ã‚Œã€ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸã€‚ãã®ãƒ­ã‚°ã‚’è¦‹ã¦ã¿ã‚‹ã¨ãƒ»ãƒ»ãƒ»FATALã‚’ç™ºè¦‹â—ï¸
```
2019-09-12 07:36:01.788 JST [988] FATAL:  could not load pg_hba.conf
```

ã¤ã¾ã‚Šã¯ã€`pg_hba.conf`ãŒèª­ã¿è¾¼ã‚ã¦ãªã„ã¨ã®ã“ã¨ã€‚ã“ã‚Œã§ã‚¨ãƒ©ãƒ¼ã®åŸå› ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚

### 3. `could not load pg_hba.conf`ã®è§£æ±ºæ–¹æ³•ã‚’èª¿ã¹ã‚‹ã€‚

[could not load pg_hba.conf ã§ãƒãƒã£ãŸ](https://qiita.com/youcune/items/7990cf36f1ae13538d61)ãŒãƒ’ãƒƒãƒˆã€‚ã“ã‚Œã‚’å‚è€ƒã«ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ã€`pg_hba.conf`ã‚’ç·¨é›†ã—ã¾ã™ã€‚
```
$ vi /etc/postgresql/11/main/pg_hba.conf
```

é–‹ã„ãŸã‚‰ã€90è¡Œç›®ã«ä»¥ä¸‹ã®é …ç›®ãŒã‚ã‚‹ã®ã§ã€è‡ªåˆ†ã®ã‚¯ãƒ©ã‚¤ã‚¨ãƒ³ãƒˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å¾Œã‚ã«/32ã‚’ã¤ã‘ã‚Œã°å®Œäº†ã€‚
ç§ã¯ã“ã“ã«/32ã‚’ã¤ã‘ã¦ã„ãªã‹ã£ãŸã®ã§ã—ãŸğŸ˜±ä»Šå›ã®ã‚¨ãƒ©ãƒ¼ã®åŸå› ã¯ã“ã“ã«ã‚ã£ãŸã‚ˆã†ã§ã™ã€‚

```
# IPv4 local connections:
host    all             all             IPã‚¢ãƒ‰ãƒ¬ã‚¹             md5
host    all             all             è‡ªåˆ†ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã€€ã€€     md5
```

4. å®Ÿéš›ã«å‹•ãã‹ã€`pg_ctlcluster 11 main start`ã§ãƒã‚§ãƒƒã‚¯ã€‚

ç„¡äº‹ã‚¨ãƒ©ãƒ¼ã¯å‡ºã•ã‚Œãšã«å‹•ã„ãŸâ—ï¸
```
$ pg_ctlcluster 11 main start
Warning: the cluster will not be running as a systemd service. Consider using systemctl:
  sudo systemctl start postgresql@11-main
Cluster is already running.
```


## ã¾ã¨ã‚
ä»Šå›ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ“ä½œã‚’å­¦ç¿’ã™ã‚‹ãŸã‚ã«postgresã‚’èµ·å‹•ã—ãŸã®ã§ã™ãŒã€æœ€åˆã§ã“ã®ã‚ˆã†ã«ã¯ã¾ã£ã¦ã—ã¾ã£ã¦ã€çµå±€åŠæ—¥ä»¥ä¸Šæ™‚é–“ã‚’ä½¿ã£ã¦ã—ã¾ã„ã¾ã—ãŸğŸ’¦
ã§ã‚‚ã€ãªã‚“ã¨ã‹ã€ã‚¨ãƒ©ãƒ¼ãŒè§£æ±ºã—ãŸã®ã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ“ä½œã‚’å­¦ã‚“ã§ã„ãã¾ã™ğŸ’ª

## å‚è€ƒã‚µã‚¤ãƒˆ
[PostgreSQL ã§ psql ã‚³ãƒãƒ³ãƒ‰ ã‚’å®Ÿè¡Œã—ãŸã‚‰ could not connect to database postgres: could not connect to server: No such file or directory ã¨å‡ºã‚‹å ´åˆ](https://obel.hatenablog.jp/entry/20181027/1540588239)

[è³‡æ–™ç·¨ï¼šUbuntuç‰¹æœ‰ã®PostgreSQLç”¨ã‚³ãƒãƒ³ãƒ‰](https://lets.postgresql.jp/documents/tutorial/ubuntu/5)

[could not load pg_hba.conf ã§ãƒãƒã£ãŸ](https://qiita.com/youcune/items/7990cf36f1ae13538d61)
