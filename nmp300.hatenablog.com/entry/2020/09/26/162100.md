---
Title: ■
Date: 2020-09-26T16:21:00+09:00
URL: https://docs.koheitakahashi.com/entry/2020/09/26/162100
EditURL: https://blog.hatena.ne.jp/NMP300/nmp300.hatenablog.com/atom/entry/26006613632718165
Draft: true
---

## はじめに
<!---
1. その本を読もうと思ったきっかけ。読む前の自分の体験・考え。
2. どうしてこの本を読んだのか
-->

Rubyを学び始めてから1年弱になるものの、なんとなくRubyを書いている感が否めませんでした。  
そして、どうもRubyを使っているのではなく、Rubyに使われているという状態でした。

もっと、Rubyを理解してRubyを使いこなしたいと思い、Rubyをより理解するために本書を手に取りました。

学んだこと、感想をまとめます。

[https://bookmeter.com/books/9870015:embed:cite]

## 本書の章立て
<!-- 3. 本の大まかなあらすじ -->

本書はⅠ部とⅡ部に別れており、以下のような章立てで構成されていました。

> Ⅰ部 メタプログラミングRuby
> 
> 1章 頭文字M
>
> 2章 月曜日: オブジェクトモデル
>
> 3章 火曜日: メソッド
>
> 4章 水曜日: ブロック
>
> 5章 木曜日: クラス定義
>
> 6章 コードを記述するコード
>
> 7章 エピローグ
>
> Ⅱ部 Railsにおけるメタプログラミング
>
> 8章 Rails ツアーの準備
>
> 9章 Active Record の設計
>
> 10章 Active Support の Concern モジュール
>
> 11章 alias_method_chain の定義
>
> 12章 アトリビュートメソッドの進化
>
> 最後の教訓
## 章ごとの感想
### 1章 頭文字M
そもそもメタプログラミングとはなんなのかという、本書の導入部分でした。

メタプログラミングとは、

> コードを記述するコードを記述すること

と本書では定義されていました。

これがどういうことなのかということは1章を読んだ時点でピンときませんでしたが、後の章を読み進めていく中でなんとなく(本当になんとなく)、この言葉の意味が理解できた気がします。
### 2章月曜日: オブジェクトモデル
メタプログラミングができる人と一緒に業務に当たっていく1週間というストーリーで書かれており、そこもユーモラスだなぁと思いました。

Rubyはオープンクラスの仕組みの説明と、それによりどのようなことが可能になっているかということがまとめられた章でした。

特に印象に残ったのは`Refinements`のお話でして、「あ、これはこの前のRuby Kaigi Takeoutで発表を聞いたことがあるぞ」と思い、その時はあまり理解できなかったのですが、本章で「どのようなものか」・「どういう問題があるのか」ということが理解できました。
### 3章火曜日: メソッド
「メソッドを動的に定義したい時はどうする?」などの、メソッドの話が中心の内容でした。

`Object#send`と`define_method`を駆使したり、`method_missing`をオーバーライドしたりという方法で上記の問題に対応できるということでした。  
動的にメソッドを定義したいという問題が開発していく中で遭遇するか分からないところですが、上記の方法を知ることができて、少し自分のRubyの世界が広がった感じがあります。
### 4章水曜日: ブロック
ブロックとはそもそもなんなのか、どのように定義されるのか、Procとlambdaの違いは？　ということがまとめられていた章でした。

普段何気なくブロックを書いていたのですが、「ブロックは束縛」ということを知って、ブロックへの理解が深まりました。

また、Procとlambdaについては存在を知っており、Procを使ったことはあったものの、どのように使い分ければ良いのかが分からなかったため、両者の違いがまとめられていて有り難かったです。
### 5章木曜日: クラス定義
`class_eval`とは？　特異メソッドとは？エイリアスを使うとどうなるの？というような内容がまとめられていた章でした。

正直なところ、この章はよく理解できず、特に「アラウンドエイリアス」というものを理解できませんでした。  
この辺りを読み返したときに理解したいと思います。
### 6章コードを記述するコード
`Kernel#eval`を使うことで、コード文字列を渡して、その文字列の処理を実行できるということがまとめられた内容でした。

ただ、それにはコードインジェクションのリスクがあるので、注意しなければならないということを理解しました。

コード文字列については、全く知らなかったため、勉強になりました。
### 8章~12章 Rails ツアー
Railsの設計、コードを見ていこうというお話なのですが、あまり理解できませんでした…。

読み返したときに、再度整理したいと思いました。

## 全体を通しての感想
> メタプログラミングは賢くなるためのものではない。柔軟になるためのものである 。

上記の言葉の意味を真に理解できているかは分かりませんが、本書を読むことで自分の中のRubyの世界が広がったという感じがあります。  

普段何気なく使っている「p・puts・print」がなぜメソッド名だけで実行できるのか、「ブロックとは、selfとは何者なのか」ということを理解できました。

また、「メタプログラミングを使ってこういう書き方ができるんだ」ということを知ることで、コードの書き方の幅が広がったように思います(チームでの開発ではあまり使ってはならないものだとは思いますが)。

自分が本書を読む前に目的として立てていた「Rubyをより理解する」という目的は十分に果たすことができましたが、一度読んだだけでは理解できなかったことが多いので、再度読み直したいと思いました。
